{% extends 'SonataAdminBundle::standard_layout.html.twig' %}
    
{% block stylesheets %}
    {% stylesheets 
        'bundles/sonatajquery/themes/flick/jquery-ui-1.8.16.custom.css' 
        'bundles/cogitowebtemplate/bootstrap/css/bootstrap.css' 
        'bundles/cogitowebtemplate/bootstrap/css/bootstrap-responsive.css' 
        'bundles/sonataadmin/x-editable/css/bootstrap-editable.css' 
        'bundles/cogitowebtemplate/js/datetimepicker/datetimepicker.css' 
        'bundles/cogitowebtemplate/js/select2/select2.css' 
        'bundles/sonataadmin/css/layout.css' 
        'bundles/sonataadmin/css/colors.css' 
        'bundles/adesignscalendar/css/fullcalendar/fullcalendar.css'
        'bundles/cogitowebtemplate/css/style.css' 
        filter='cssrewrite' filter='?uglifycss' output='css/compiledcss' %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
    
    <link rel="stylesheet" href="{{ asset('bundles/cogitowebtemplate/css/print.css') }}" media="print" />
    
    {% include 'CogitowebTemplateBundle:Override:head_css.html.twig' %}
{% endblock %}

{% block javascripts %}
    <script>
        window.SONATA_CONFIG = {
            CONFIRM_EXIT: {% if admin_pool is defined and admin_pool.getOption('confirm_exit') %}true{% else %}false{% endif %},
            USE_SELECT2: {% if admin_pool is defined and admin_pool.getOption('use_select2') %}true{% else %}false{% endif %}
        };
        window.SONATA_TRANSLATIONS = {
            CONFIRM_EXIT:  '{{ 'confirm_exit'|trans({}, 'SonataAdminBundle')|escape('js') }}'
       };
       window.CURRENT_LOCALE = '{{ app.request.locale }}';
    </script>
    {% javascripts
        '@SonatajQueryBundle/Resources/public/jquery-1.8.3.js'
        '@SonatajQueryBundle/Resources/public/jquery-ui-1.8.23.js'
        '@CogitowebTemplateBundle/Resources/public/js/jquery/jquery-ui-i18n.js'
        '@SonataAdminBundle/Resources/public/bootstrap/js/bootstrap.min.js' 
        '@SonataAdminBundle/Resources/public/x-editable/js/bootstrap-editable.min.js' 
        '@CogitowebTemplateBundle/Resources/public/js/select2/select2.min.js' 
        '@CogitowebTemplateBundle/Resources/public/js/datetimepicker/jquery-ui-timepicker-addon.min.js' 
        '@CogitowebTemplateBundle/Resources/public/js/datetimepicker/jquery-ui-timepicker-addon-i18n.min.js' 
        '@SonataAdminBundle/Resources/public/jquery/jquery.form.js' 
        '@SonataAdminBundle/Resources/public/jquery/jquery.confirmExit.js' 
        '@SonataAdminBundle/Resources/public/base.js' 
        '@CogitowebTemplateBundle/Resources/public/js/fullcalendar/fullcalendar.min.js'
        '@CogitowebTemplateBundle/Resources/public/js/support.js'
        filter='?uglifyjs2' output='js/compiledjs' %}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
    
    <script src="{{ asset('bundles/cogitowebtemplate/js/select2/select2_locale_' ~ app.request.locale ~ '.js') }}"></script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
   
    {% include 'CogitowebTemplateBundle:Override:head_js.html.twig' %}
    
{% endblock %}
    

{% block sonata_nav %}
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container-fluid">
                
                
                {% if admin_pool is defined %}
                    <div class="navbar-text pull-right">{% include admin_pool.getTemplate('user_block') %}</div>

                    {% block logo %}
                        <a href="{{ url('homepage') }}" class="brand">
                            {{ admin_pool.title }}
                        </a>
                    {% endblock %}
                    
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>

                    {% block sonata_nav_menu_before %}{% endblock %}

                    {% block sonata_nav_menu %}
                        <div class="nav-collapse">
                            <ul class="nav">
                                
                                {% block top_bar_before_nav %} 
                                    <li class="homelink">
                                        <a href="{{ url('homepage') }}" >Home</a>
                                    </li>
                                {% endblock %}

                                
                                {% block sonata_top_bar_nav %}
                                    {% if app.security.token and is_granted('ROLE_SONATA_ADMIN') %}
                                        {% for group in admin_pool.dashboardgroups %}
                                            {% set display = (group.roles is empty or is_granted('ROLE_SUPER_ADMIN') ) %}
                                            {% for role in group.roles if not display %}
                                                {% set display = is_granted(role) %}
                                            {% endfor %}

                                            {# Do not display the group label if no item in group is available #}
                                            {% set item_count = 0 %}
                                            {% if display %}
                                                {% for admin in group.items if item_count == 0 %}
                                                    {% if admin.hasroute('list') and admin.isGranted('LIST') %}
                                                        {% set item_count = item_count+1 %}
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}

                                            {% if display and (item_count > 0) %}
                                            <li class="dropdown">
                                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ group.label|trans({}, group.label_catalogue) }} <span class="caret"></span></a>
                                                <ul class="dropdown-menu">
                                                    {% for admin in group.items %}
                                                        {% if admin.hasroute('list') and admin.isGranted('LIST') %}
                                                            <li{% if app.request.get('_sonata_admin') == admin.code %} class="active"{% endif %}><a href="{{ admin.generateUrl('list')}}">{{ admin.label|trans({}, admin.translationdomain) }}</a></li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ul>
                                            </li>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                {% endblock %}
                                {% block top_bar_after_nav %} {% endblock %}
                            </ul>
                            
                            <div class="btn-group">
                                <a class="btn btn-inverse dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="icon-print white-icon"></i>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="javascript:window.print()">
                                            Stampa la pagina
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:printDiv();" id="printAllButton">
                                            Stampa tutto
                                        </a>
                                        <script>
                                        var print_all_url = '';
                                        var reset_page_url = '';
                                        function choosePrintActions() {
                                            var page_url = document.location.href;
                                            
                                            if(page_url.indexOf('/list') < 0) {
                                                $('#printAllButton').hide();
                                            }
                                            else {
                                                page_url = page_url.replace(/\?filter\[_per_page\]=\d+|\&filter\[_per_page\]=\d+/gi, ""); 
                                                
                                                reset_page_url = page_url;
                                                reset_page_url += (page_url.indexOf('?') < 0) ? '?' : '&';
                                                reset_page_url += 'filter[_per_page]=25';
           
                                                print_all_url = reset_page_url + '00';
                                            }
                                        }
                                        choosePrintActions();
                                            
                                        function printDiv() {
                                            var disp_setting="toolbar=no,location=no,directories=no,menubar=no, scrollbars=no,width=600, height=825, left=100, top=25";
                                             
                                            var newWin = window.open(print_all_url, "Stampa tutto", disp_setting);
                                            
                                            var interval = window.setInterval(function() {
                                                try {
                                                    if (newWin.loaded && newWin.focus) {
                                                        window.clearInterval(interval);

                                                            newWin.close();
                                                            window.location.href = reset_page_url;
                                                    }
                                                }
                                                catch (e) {
                                                }
                                            }, 500);

                                            alert(newWin.print());
                                            
                                            
                                        }
                                        
                                        </script>
                                    </li>
                                </ul>
                            </div>

                            {% block sonata_top_bar_search %}
                            {% endblock %}

                        </div>
                    {% endblock %}

                    {% block sonata_nav_menu_after %}{% endblock %}

                {% endif %}
            </div>
        </div>
    </div>
{% endblock sonata_nav %}


            
    
 {% block sonata_page_content %}
    {% block notice %}
        {% include 'SonataCoreBundle:FlashMessage:render.html.twig' %}
    {% endblock %}

    <div class="row-fluid">
        {% block sonata_breadcrumb %}
            {% if _breadcrumb is not empty or action is defined %}
                <div class="span12 breadcrumb-wrapper">
                    
                    {% if _actions is not empty %}
                            {{ _actions|raw }}
                    {% endif %}
                    
                    <ul class="breadcrumb">
                        {% if _breadcrumb is empty %}
                            {% if action is defined %}
                                {% for menu in admin.breadcrumbs(action) %}
                                    {% if not loop.last  %}
                                        <li>
                                            {% if menu.uri is not empty %}
                                                <a href="{{ menu.uri }}">{{ menu.label }}</a>
                                            {% else %}
                                                {{ menu.label }}
                                            {% endif %}
                                            <span class="divider">/</span>
                                        </li>
                                    {% else %}
                                        <li class="active">{{ menu.label }}</li>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% else %}
                            {{ _breadcrumb|raw }}
                        {% endif %}
                    </ul>
                </div>
            {% endif %}
        {% endblock sonata_breadcrumb %}

        
    </div>

    <div class="row-fluid">
        {% if _side_menu is not empty %}
            <div class="sidebar span2">
                <div class="well sonata-ba-side-menu" style="padding: 8px 0;">{{ _side_menu|raw }}</div>
            </div>
        {% endif %}

        <div class="content {{ _side_menu is not empty ? ' span10' : 'span12' }}">
            {% block sonata_admin_content %}

                {% if _preview is not empty %}
                    <div class="sonata-ba-preview">{{ _preview|raw }}</div>
                {% endif %}

                {% if _content is not empty %}
                    <div class="sonata-ba-content">{{ _content|raw }}</div>
                {% endif %}

                {% if _show is not empty %}
                    <div class="sonata-ba-show">{{ _show|raw }}</div>
                {% endif %}

                {% if _form is not empty %}
                    <div class="sonata-ba-form">{{ _form|raw }}</div>
                {% endif %}

                {% if _list_table is not empty or _list_filters is not empty %}
                    <div class="row-fluid">
                        <div class="sonata-ba-list {% if _list_filters|trim %}span10{% else %}span12{% endif %}">
                            {{ _list_table|raw }}
                        </div>
                        {% if _list_filters|trim %}
                            <div class="sonata-ba-filter span2">
                                {{ _list_filters|raw }}
                            </div>
                        {% endif %}
                    </div>
                {% endif %}

            {% endblock %}
        </div>
    </div>

    {% block footer %}
        <span class="fixed-footer-logo">
            <a href="http://www.cogitoweb.it/"  target="_blank">
                Powered by Cogito
            </a>
        </span>
        
        <div class="modal-loader"><!-- modal loader --></div>
    {% endblock %}
{% endblock %}
